# js 中的 number 为何很怪异

> 声明：需要读者对二进制有一定的了解

对于 JavaScript 开发者来说，或多或少都遇到过 `js` 在处理数字上的奇怪现象，比如：

```
> 0.1 + 0.2
0.30000000000000004

> 0.1 + 1 - 1
0.10000000000000009

> 0.1 * 0.2
0.020000000000000004

> Math.pow(2, 53)
9007199254740992

> Math.pow(2, 53) + 1
9007199254740992

> Math.pow(2, 53) + 3
9007199254740996
```

如果想要弄明白为什么会出现这些奇怪现象，首先要弄清楚 *JavaScript 是怎样编码数字的*。

## 1. JavaScript 是怎样编码数字的

JavaScript 中的数字，不管是整数、小数、分数，还是正数、负数，全部是浮点数，都是用 4 个字节（64 位）来存储的。

一个数字（如 `12`、`0.12`、`-999`）在内存中占用 4 个字节（64 位），存储方式如下：

1. `0 - 51`：分数部分（52 位）
2. `52 - 62`：指数部分（11 位）
3. `63`：符号位（1 位：0 表示这个数是正数，1 表示这个数是负数）

符号位很好理解，用于指明是正数还是负数，且只有 1 位、两种情况（0 表示正数，1 表示负数）。

其他两部分是分数部分和指数部分，用于计算一个数的绝对值，计算公式如下：

```
abs = 1.f * 2 ^ (p - 1023)
```

说明：

- 公式是二进制的算法公式，结果用 `abs` 表示，分数部分用 `f` 表示，指数部分用 `p` 表示
- `2 ^ (p - 1023)` 表示 `2` 的 `p - 1023` 次方
- 因为分数部分占 52 位，所以 `f` 的取值范围为 `00...00`（中间省略 48 个 0） 到 `11...11`（中间省略 48 个 1）
- 因为指数部分占 11 位，所以 `p` 的取值范围为 `0`（`00000000000`） 到 `2047`（`11111111111`）

从上面的公式可以看出：

- `1` 的存储方式：`1.00 * 2 ^ (1023 - 1023)`（`f = 0000..., p = 1023`，`...` 表示 48 个 0）
- `9` 的存储方式：`1.01 * 2 ^ (1025 - 1023)`（`f = 0100..., p = 1025`，`...` 表示 48 个 0）
- `0.5` 的存储方式：`1.00 * 2 ^ (1022 - 1023)`（`f = 0000..., p = 1022`，`...` 表示 48 个 0）

聪明的你一定会发现，这个式子无法表示 `0`，因为这个式子是一个指数，永远大于 `0`。

所以，就引出了一条特殊规则：

`p = 0, p = 2017` 为保留位，其中：
  
1.  

## 2. Number 对象中的常量

## 参考文章

- [How numbers are encoded in JavaScript](http://2ality.com/2012/04/number-encoding.html)
- [JavaScript是怎样编码数字的](https://segmentfault.com/a/1190000017090272)

## 后续

更多博客，查看 [https://github.com/senntyou/blogs](https://github.com/senntyou/blogs)

作者：[深予之 (@senntyou)](https://github.com/senntyou)

版权声明：自由转载-非商用-非衍生-保持署名（[创意共享3.0许可证](https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh)）
